<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Warnings and known issues</title>
  
  <meta name="author" content="Travis Brown"/>
  
  <meta name="author" content="Zach McCoy"/>
  
  <meta name="author" content="Darren Gibson"/>
  
  
  <meta name="description" content="Circe docs"/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="../images/circe_light_no_border_146x173.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../helium/site/laika-helium.css" />
  <script src="../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="https://github.com/circe/circe"><img src="../images/circe_light_no_border_146x173.png"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://github.com/circe/circe"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://github.com/circe/circe"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../quickstart.html">Quick Start</a></li>
    <li class="level1 nav-leaf"><a href="../parsing.html">Parsing JSON</a></li>
    <li class="level1 nav-leaf"><a href="../cursors.html">Traversing and modifying JSON</a></li>
    <li class="level1 nav-node"><a href="index.html">Encoding and Decoding</a></li>
    <li class="level2 nav-leaf"><a href="semiauto-derivation.html">Semi-automatic Derivation</a></li>
    <li class="level2 nav-leaf"><a href="auto-derivation.html">Automatic Derivation</a></li>
    <li class="level2 nav-leaf"><a href="custom-codecs.html">Custom Codecs</a></li>
    <li class="level2 nav-leaf"><a href="adt.html">ADT (Algebraic Data Types)</a></li>
    <li class="level2 nav-leaf"><a href="testing.html">Codec Testing</a></li>
    <li class="level2 active nav-leaf"><a href="#">Warnings and known issues</a></li>
    <li class="level2 nav-leaf"><a href="recursive-adt.html">Recursive ADT (Algebraic Data Types)</a></li>
    <li class="level1 nav-leaf"><a href="../optics.html">Optics</a></li>
    <li class="level1 nav-leaf"><a href="../performance.html">Performance</a></li>
    <li class="level1 nav-header">Related Projects</li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-fs2">circe-fs2</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-iteratee">circe-iteratee</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-generic-extras">circe-generic-extras</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-derivation">circe-derivation</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-optics">circe-optics</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-droste">circe-droste</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-spire">circe-spire</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-config">circe-config</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-yaml">circe-yaml</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-bson">circe-bson</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-schema">circe-schema</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-golden">circe-golden</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-json-schema">circe-json-schema</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-jackson">circe-jackson</a></li>
    <li class="level2 nav-leaf"><a href="https://github.com/circe/circe-argus">circe-argus</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Warnings and known issues</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#knowndirectsubclasses-error"><code>knownDirectSubclasses</code> error</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="warnings-and-known-issues" class="title">Warnings and known issues</h1>
        <ol class="arabic">
          <li>
            <p>Generic derivation may not work as expected when the type definitions that you&#39;re trying to
            derive instances for are at the same level as the attempted derivation. For example:</p>
            <pre><code>scala&gt; import io.circe.Decoder, io.circe.generic.auto._
import io.circe.Decoder
import io.circe.generic.auto._

scala&gt; sealed trait A; case object B extends A; object X { val d = Decoder[A] }
defined trait A
defined object B
defined object X

scala&gt; object X { sealed trait A; case object B extends A; val d = Decoder[A] }
&lt;console&gt;:19: error: could not find implicit value for parameter d: io.circe.Decoder[X.A]
      object X { sealed trait A; case object B extends A; val d = Decoder[A] }</code></pre>
            <p>This is unfortunately a limitation of the macro API that Shapeless uses to derive the generic
            representation of the sealed trait. You can manually define these instances, or you can arrange
            the sealed trait definition so that it is not in the same immediate scope as the attempted
            derivation (which is typically what you want, anyway).</p>
          </li>
          <li>
            <p>For large or deeply-nested case classes and sealed trait hierarchies, the generic derivation
            provided by the <code>generic</code> subproject may stack overflow during compilation, which will result in
            the derived encoders or decoders simply not being found. Increasing the stack size available to
            the compiler (e.g. with <code>sbt -J-Xss64m</code> if you&#39;re using SBT) will help in many cases, but we have
            at least <a href="http://stackoverflow.com/questions/33318802/scala-parse-json-of-more-than-22-elements-into-case-class/33319168?noredirect=1#comment55069438_33319168">one report</a> of a case where it doesn&#39;t.
            It might be simpler and safer to add <code>.sbtopts</code> file with SBT parameters (<code>-J-Xss64m</code>) in root of project.</p>
          </li>
          <li>
            <p>More generally, the generic derivation provided by the <code>generic</code> subproject works for a wide
            range of test cases, and is likely to <em>just work</em> for you, but it relies on macros (provided by
            Shapeless) that rely on compiler functionality that is not always perfectly robust
            (&quot;<a href="https://issues.scala-lang.org/browse/SI-7046">SI-7046</a> is like <a href="https://twitter.com/li_haoyi/status/637281580847878145">playing roulette</a>&quot;), and if you&#39;re running into
            problems, it&#39;s likely that they&#39;re not your fault. Please file an issue here 
            or ask a question on <a href="https://discord.gg/XF3CXcMzqD">Discord</a> 
            (use the <a href="https://discordapp.com/channels/632277896739946517/877550996191084554">#circe</a> channel), 
            and we&#39;ll do our best to figure out whether the problem is something we can fix.</p>
          </li>
          <li>
            <p>When using the <code>io.circe.generic.JsonCodec</code> annotation, the following will not compile:</p>
            <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">generic</span><span>.</span><span class="type-name">JsonCodec</span><span>

</span><span class="annotation">@JsonCodec</span><span> </span><span class="keyword">sealed</span><span> </span><span class="keyword">trait</span><span> </span><span class="type-name">A</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">B</span><span>(</span><span class="identifier">b</span><span>: </span><span class="type-name">String</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">A</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">C</span><span>(</span><span class="identifier">c</span><span>: </span><span class="type-name">Int</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">A</span></code></pre>
            <p>In cases like this it&#39;s necessary to define a companion object for the root type <em>after</em> all of
            the leaf types:</p>
            <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">generic</span><span>.</span><span class="type-name">JsonCodec</span><span>

</span><span class="annotation">@JsonCodec</span><span> </span><span class="keyword">sealed</span><span> </span><span class="keyword">trait</span><span> </span><span class="type-name">A</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">B</span><span>(</span><span class="identifier">b</span><span>: </span><span class="type-name">String</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">A</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">C</span><span>(</span><span class="identifier">c</span><span>: </span><span class="type-name">Int</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">A</span><span>

</span><span class="keyword">object</span><span> </span><span class="type-name">A</span></code></pre>
            <p>See <a href="https://github.com/circe/circe/issues/251">this issue</a> for additional discussion (this workaround may not be necessary in
            future versions).</p>
          </li>
          <li>
            <p>circe&#39;s representation of numbers is designed not to lose precision during decoding into integral
            or arbitrary-precision types, but precision may still be lost during parsing. This shouldn&#39;t
            happen when using Jawn for parsing, but <code>scalajs.js.JSON</code> parses JSON numbers into a floating
            point representation that may lose precision (even when decoding into a type like <code>BigDecimal</code>;
            see <a href="https://github.com/circe/circe/issues/262">this issue</a> for an example).</p>
          </li>
        </ol>
        
        <h3 id="knowndirectsubclasses-error" class="section"><a class="anchor-link left" href="#knowndirectsubclasses-error"><i class="icofont-laika link">&#xef71;</i></a><code>knownDirectSubclasses</code> error</h3>
        <p>While using fully automatic derivation, you may have run into an error that looks like this:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">knownDirectSubclasses</span><span> </span><span class="identifier">of</span><span> &lt;</span><span class="keyword">class</span><span>&gt; </span><span class="identifier">observed</span><span> </span><span class="identifier">before</span><span> </span><span class="identifier">subclass</span><span> &lt;</span><span class="keyword">class</span><span>&gt; </span><span class="identifier">registered</span></code></pre>
        <p>This is a known issue (<a href="https://github.com/circe/circe/issues/434">#434</a>, <a href="https://github.com/circe/circe/issues/639">#659</a>)
        that stems from the way fully automatic derivation relies on Shapeless, which in turn conditionally
        calls a Scala Reflect named called <code>knownDirectSubclasses</code>. This method has been known to fail depending
        on how the types that it interacts with are declared in your codebase.</p>
        <p>Here is a collection workarounds found by other users that you can try:</p>
        <ol class="arabic">
          <li>Rename your files/directories so that the files containing types that get encoded/decoded come
           alphabetically before the files that <code>import io.circe.generic.auto._</code> and turn values of those
           types into JSON.</li>
        </ol>
        <ol class="arabic">
          <li>
            <p>If you&#39;ve got a sealed trait (e.g. <code>sealed trait MyEnum</code>) and it has subclasses that are declared
             in its companion object, try adding a <code>import MyEnum._</code> statement before any calls that force the
             materialising of an encoder/decoder.</p>
            <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">generic</span><span>.</span><span class="identifier">auto</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">person</span><span> = </span><span class="type-name">Person</span><span>(</span><span class="string-literal">&quot;hello&quot;</span><span>, </span><span class="type-name">Role</span><span>.</span><span class="type-name">User</span><span>)
</span><span class="keyword">import</span><span> </span><span class="type-name">Role</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">asJson</span><span> = </span><span class="identifier">person</span><span>.</span><span class="identifier">asJson</span></code></pre>
            <ul>
              <li>
                <p>Alternatively, if you are OK with losing namespacing for your enum members you can try moving
                the subclasses out of the parent trait&#39;s companion object and into the same namespace space
                as the parent trait:</p>
                <pre><code class="nohighlight"><span class="comment">// Modify this
</span><span class="keyword">sealed</span><span> </span><span class="keyword">trait</span><span> </span><span class="type-name">ShirtSize</span><span>

</span><span class="keyword">object</span><span> </span><span class="type-name">ShirtSize</span><span> {
 </span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">Small</span><span>  </span><span class="keyword">extends</span><span> </span><span class="type-name">ShirtSize</span><span>
 </span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">Medium</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">ShirtSize</span><span>
 </span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">Large</span><span>  </span><span class="keyword">extends</span><span> </span><span class="type-name">ShirtSize</span><span>
}

</span><span class="comment">// into this
</span><span class="keyword">sealed</span><span> </span><span class="keyword">trait</span><span> </span><span class="type-name">ShirtSizes</span><span>

</span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">Small</span><span>  </span><span class="keyword">extends</span><span> </span><span class="type-name">ShirtSizes</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">Medium</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">ShirtSizes</span><span>
</span><span class="keyword">case</span><span> </span><span class="keyword">object</span><span> </span><span class="type-name">Large</span><span>  </span><span class="keyword">extends</span><span> </span><span class="type-name">ShirtSizes</span></code></pre>
              </li>
            </ul>
          </li>
        </ol>
        <ol class="arabic">
          <li>Try using Scala 2.11.8, the last known version of Scala that did not exhibit this problem.</li>
        </ol>
        <p>If none of these workarounds are desirable for your use case, it might be a good idea to try semi-auto derivation instead.</p>

        
<hr class="footer-rule"/>
<footer>
  Site generated by <a href="https://typelevel.org/Laika/">Laika</a> with the Helium theme.
</footer>


      </main>

    </div>

  </body>

</html>